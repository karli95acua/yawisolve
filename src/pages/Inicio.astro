---
import LoginCard from '../components/LoginCard.astro';

async function handleLogin(email: string, password: string) {
  try {
    const response = await fetch("http://localhost:4000/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })  // Enviar datos ingresados por el usuario
    });

    const data = await response.json();
    if (!response.ok) throw new Error(data.message || "Error en el login");

    localStorage.setItem("token", data.token);  // Guardar el token
    window.location.href = "/";  // Redirigir al usuario autenticado
  } catch (error) {
    console.error("Error en el login:", error);

    //Manejo seguro del error
    const errorMessage = error instanceof Error ? error.message : "Ocurri칩 un error desconocido";
    alert(errorMessage);
  }
}


function handleForgotPassword() {
  alert("Funci칩n de recuperaci칩n de contrase침a en desarrollo.");
}
---

<html lang="es">
  <meta charset="UTF-8" />
  <head>
    <title>Login - Yawi Solve</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background: url('/fondo1.jpg') no-repeat center center fixed;
        background-size: cover;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <LoginCard
      onLogin={handleLogin}
      onForgotPassword={handleForgotPassword}
    />
  </body>
</html>
